/*
   Copyright 2025 CVS Health and/or one of its affiliates

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
 */
package com.cvshealth.accessibility.apps.androidviewaccessibilitytechniques

import androidx.test.espresso.Espresso.onView
import androidx.test.espresso.accessibility.AccessibilityChecks
import androidx.test.espresso.action.ViewActions
import androidx.test.espresso.assertion.ViewAssertions
import androidx.test.espresso.assertion.ViewAssertions.matches
import androidx.test.espresso.matcher.ViewMatchers.*
import androidx.test.ext.junit.rules.activityScenarioRule
import androidx.test.ext.junit.runners.AndroidJUnit4
import androidx.test.platform.app.InstrumentationRegistry
import com.google.android.apps.common.testing.accessibility.framework.AccessibilityCheckResult.AccessibilityCheckResultType
import com.google.android.apps.common.testing.accessibility.framework.AccessibilityCheckResultUtils.matchesCheckNames
import com.google.android.apps.common.testing.accessibility.framework.AccessibilityCheckResultUtils.matchesViews
import org.hamcrest.Matchers.*
import org.junit.Assert.*
import org.junit.Before
import org.junit.BeforeClass
import org.junit.Rule
import org.junit.Test
import org.junit.runner.RunWith

/**
 * Instrumented test, which will execute on an Android device.
 *
 * See [testing documentation](http://d.android.com/tools/testing) and
 * [Accessibility testing - Automated testing](https://developer.android.com/guide/topics/ui/accessibility/testing#automated).
 */
@RunWith(AndroidJUnit4::class)
class AllScreensOpenTests {

    @get:Rule var activityScenarioRule = activityScenarioRule<MainActivity>()

    // Expand the Accessibility Basics section
    fun expandAccessibilityBasicsSection() {
        onView(withId(R.id.linear_layout_section_1_expand_collapse_header))
            .perform(ViewActions.scrollTo())
            .perform(ViewActions.click())
    }

    // Expand the Grouping and Ordering section
    fun expandGroupingAndOrderingSection() {
        onView(withId(R.id.linear_layout_section_2_expand_collapse_header))
            .perform(ViewActions.scrollTo())
            .perform(ViewActions.click())
    }

    // Expand the Dynamic Behaviors section
    fun expandDynamicBehaviorsSection() {
        onView(withId(R.id.linear_layout_section_3_expand_collapse_header))
            .perform(ViewActions.scrollTo())
            .perform(ViewActions.click())
    }

    // Expand the Specific Component Types section
    fun expandSpecificComponentTypesSection() {
        onView(withId(R.id.linear_layout_section_4_expand_collapse_header))
            .perform(ViewActions.scrollTo())
            .perform(ViewActions.click())
    }

    // Accessibility Basics screen tests

    @Test
    fun validateTextAlternativesScreen() {
        expandAccessibilityBasicsSection()

        // Open the Text Alternatives demo
        onView(withId(R.id.text_text_alternatives))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_text_alternatives)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.text_alternatives_heading)))
    }

    @Test
    fun validateInputFieldLabelsScreen() {
        expandAccessibilityBasicsSection()

        // Open the Input field labels demo
        onView(withId(R.id.text_input_field_labels))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_input_field_labels)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.input_field_labels_heading)))
    }

    @Test
    fun validateFocusableClickableControlsScreen() {
        expandAccessibilityBasicsSection()

        // Open the Focusable, Clickable Controls demo
        onView(withId(R.id.text_focusable_controls))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_focusable_controls)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.focusable_controls_heading)))
    }

    @Test
    fun validateTextResizingAndReflowScreen() {
        expandAccessibilityBasicsSection()

        // Open the Text Resizing and Reflow demo
        onView(withId(R.id.text_text_resizing))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_text_resizing)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.text_resizing_heading)))
    }

    @Test
    fun validateMinimumTouchTargetSizeScreen() {
        expandAccessibilityBasicsSection()

        // Open the Minimum Touch Target Size demo
        onView(withId(R.id.text_target_size))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_target_size)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.target_size_heading)))
    }

    @Test
    fun validateDeviceOrientationScreen() {
        expandAccessibilityBasicsSection()

        // Open the Device Orientation demo
        onView(withId(R.id.text_orientation))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_orientation)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.orientation_heading)))
    }

    @Test
    fun validateDarkThemeScreen() {
        expandAccessibilityBasicsSection()

        // Open the Dark Theme demo
        onView(withId(R.id.text_dark_theme))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_dark_theme)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.dark_theme_heading)))
    }

    // Grouping and Ordering screen tests

    @Test
    fun validateTapTargetGroupingScreen() {
        expandGroupingAndOrderingSection()

        // Open the Tap Target Grouping demo
        onView(withId(R.id.text_tap_target_grouping))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_tap_target_grouping)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.tap_target_grouping_heading)))
    }

    @Test
    fun validateContentGroupingScreen() {
        expandGroupingAndOrderingSection()

        // Open the Content Grouping demo
        onView(withId(R.id.text_content_grouping))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_content_grouping)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.content_grouping_heading)))
    }

    @Test
    fun validateContentGroupReplacementScreen() {
        expandGroupingAndOrderingSection()

        // Open the Content Group Replacement demo
        onView(withId(R.id.text_content_group_replacement))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_content_group_replacement)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.content_group_replacement_heading)))
    }

    @Test
    fun validateHeadingSemanticsScreen() {
        expandGroupingAndOrderingSection()

        // Open the Heading Semantics demo
        onView(withId(R.id.text_heading_semantics))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_heading_semantics)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.heading_semantics_heading)))
    }

    @Test
    fun validateListSemanticsScreen() {
        expandGroupingAndOrderingSection()

        // Open the List Semantics demo
        onView(withId(R.id.text_list_semantics))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_list_semantics)))
            .perform(ViewActions.click())
        // Multiple Views have the id.text_heading, so must revise this check.
        onView(
            allOf(
                withId(R.id.text_heading),
                withText(R.string.list_semantics_heading)
            )
        ).check(matches(isDisplayed()))
    }

    @Test
    fun validateAccessibilityReadingOrderScreen() {
        expandGroupingAndOrderingSection()

        // Open the Accessibility Reading Order demo
        onView(withId(R.id.text_accessibility_reading_order))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_accessibility_reading_order)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.accessibility_reading_order_heading_1)))
    }

    @Test
    fun validateKeyboardFocusOrderScreen() {
        expandGroupingAndOrderingSection()

        // Open the Keyboard and Accessibility Focus Order demo
        onView(withId(R.id.text_keyboard_focus_order))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_keyboard_focus_order)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.keyboard_focus_order_heading_1)))
    }

    @Test
    fun validateArrowKeyFocusOrderScreen() {
        expandGroupingAndOrderingSection()

        // Open the Arrow Key Focus Order demo
        onView(withId(R.id.text_arrow_key_focus_order))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_arrow_key_focus_order)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.arrow_key_focus_order_heading_1)))
    }

    // Dynamic Behaviors screen tests

    @Test
    fun validateUxChangeAnnouncementsScreen() {
        expandDynamicBehaviorsSection()

        // Open the UX Change Announcements demo
        onView(withId(R.id.text_ux_change_announcements))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_ux_change_announcements)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.ux_change_announcements_heading)))
    }

    @Test
    fun validateInputErrorAnnouncementsScreen() {
        expandDynamicBehaviorsSection()

        // Open the Input Error Announcements demo
        onView(withId(R.id.text_input_error_announcements))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_input_error_announcements)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.input_error_announcements_heading)))
    }

    @Test
    fun validateAnimationControlScreen() {
        expandDynamicBehaviorsSection()

        // Open the Animation Control demo
        onView(withId(R.id.text_animation_control))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_animation_control)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.animation_control_heading)))
    }

    @Test
    fun validateKeyboardTypeScreen() {
        expandDynamicBehaviorsSection()

        // Open the Keyboard Type demo
        onView(withId(R.id.text_keyboard_type))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_keyboard_type)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.keyboard_type_heading)))
    }

    @Test
    fun validateAccessibilityActionLabelsScreen() {
        expandDynamicBehaviorsSection()

        // Open the Accessibility Action Labels demo
        onView(withId(R.id.text_accessibility_action_labels))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_accessibility_action_labels)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.accessibility_action_labels_heading)))
    }

    @Test
    fun validateCustomStateDescriptionsScreen() {
        expandDynamicBehaviorsSection()

        // Open the Custom State Descriptions demo
        onView(withId(R.id.text_custom_state_descriptions))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_custom_state_descriptions)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.custom_state_descriptions_heading)))
    }

    @Test
    fun validateCustomAccessibilityActionsScreen() {
        expandDynamicBehaviorsSection()

        // Open the Custom Accessibility Actions demo
        onView(withId(R.id.text_custom_accessibility_actions))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_custom_accessibility_actions)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.custom_accessibility_actions_heading)))
    }

    @Test
    fun validateCustomFocusIndicatorsScreen() {
        expandDynamicBehaviorsSection()

        // Open the Custom Focus Indicators demo
        onView(withId(R.id.text_focus_visibility))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_focus_visibility)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.focus_visibility_heading)))
    }

    // Specific Component Types screen tests

    @Test
    fun validateAccordionControlsScreen() {
        expandSpecificComponentTypesSection()

        // Open the Accordion Controls demo
        onView(withId(R.id.text_accordion))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_accordion)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.accordion_heading)))
    }

    @Test
    fun validateAutocompleteInputControlsScreen() {
        expandSpecificComponentTypesSection()

        // Open the Autocomplete Input Controls demo
        onView(withId(R.id.text_autocomplete))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_autocomplete)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.autocomplete_heading)))
    }

    @Test
    fun validateAutofillInputFieldsScreen() {
        expandSpecificComponentTypesSection()

        // Open the Autofill Input Fields demo
        onView(withId(R.id.text_autofill))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_autofill)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.autofill_heading)))
    }

    @Test
    fun validateDropdownSelectionMenusScreen() {
        expandSpecificComponentTypesSection()

        // Open the Dropdown Selection Menus demo
        onView(withId(R.id.text_dropdown))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_dropdown)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.dropdown_heading)))
    }

    @Test
    fun validateLinksInlineWithTextScreen() {
        expandSpecificComponentTypesSection()

        // Open the Links Inline with Text demo
        onView(withId(R.id.text_inline_links))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_inline_links)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.inline_links_heading)))
    }

    @Test
    fun validateRatingBarControlsScreen() {
        expandSpecificComponentTypesSection()

        // Open the RatingBar Controls demo
        onView(withId(R.id.text_rating_bar_controls))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_ratingbar_controls)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.ratingbar_controls_heading)))
    }

    @Test
    fun validateTextLanguageIdentificationScreen() {
        expandSpecificComponentTypesSection()

        // Open the Text Language Identification demo
        onView(withId(R.id.text_language_identification))
            .perform(ViewActions.scrollTo())
            .check(matches(withText(R.string.menu_language_identification)))
            .perform(ViewActions.click())
        onView(withId(R.id.text_heading))
            .check(matches(withText(R.string.language_identification_heading)))
    }
}